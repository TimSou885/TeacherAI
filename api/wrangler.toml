name = "teacherai"
main = "src/index.ts"
compatibility_date = "2026-02-01"

[vars]
SUPABASE_URL = "https://gjeavzfghdjlnmkyenym.supabase.co"

# Secrets (set via: npx wrangler secret put <NAME>)
# SUPABASE_SERVICE_ROLE_KEY
# SUPABASE_JWT_SECRET  (from Supabase Project Settings > API > JWT Secret)
# STUDENT_JWT_SECRET   (Phase 1: 學生 JWT 簽名用，建議 32 字元以上隨機字串)
# AZURE_OPENAI_API_KEY
# AZURE_OPENAI_ENDPOINT (e.g. https://xxx.openai.azure.com/)

# Optional for Phase 0 (RAG later)
# [[kv_namespaces]]
# binding = "CACHE"
# id = ""

# TTS 音頻快取（Phase 1 默書）：先建立 bucket → npx wrangler r2 bucket create teacherai-tts
[[r2_buckets]]
binding = "R2_TTS"
bucket_name = "teacherai-tts"

# RAG：請先執行一次：npx wrangler vectorize create teacherai-embeddings --dimensions=1536 --metric=cosine
# 並設定 secret：npx wrangler secret put ADMIN_EMBED_SECRET
[[vectorize]]
binding = "VECTORIZE"
index_name = "teacherai-embeddings"

# 每晚 23:00 UTC 執行 AI 對話掃描
[triggers]
crons = ["0 23 * * *"]
